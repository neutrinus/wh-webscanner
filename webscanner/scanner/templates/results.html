{% extends "base.html" %}
{% load humanize %}

{% block title %}Free scan results{% endblock %}

{% block extrahead %} 
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}style_results.css" />
    <link type="text/css" href="{{ STATIC_URL }}css/ui-lightness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />   
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    
    <style>
    .ui-progressbar-value { background-image: url({{ STATIC_URL }}css/ui-lightness/images/pbar-ani.gif);  }
    </style>
    
    
    
    <script type="text/javascript">
    testid = {{ test.pk }};
    </script>
{% endblock %}


{% block content %}
{{ test.pk }}
<div id="content">
<h1>SCAN Results </h1>

<div id="progressbar"></div>

<div id="results"></div>


<ul>
<li>Screenshots</li>
<li>Basic</li>
<li>SEO</li>
<li>Security</li>
<li>Optimalization</li>
</ul>

</div>


<script type="text/javascript">
$("#progressbar").progressbar({ value: 0 });


    

function check_progress(){
    $.ajax({
        url: "{% url scanner.views.scan_progress %}",
        data: "",
        success: function(data) {
            $("#progressbar").progressbar({ value: (data.done/data.ordered)*100 });
            if (data.done/data.ordered != 1) {
                window.setTimeout(check_progress,2000);
            } else {
                $("#progressbar").fadeOut();
            }
        },
        error:function (xhr, ajaxOptions, thrownError){ alert(xhr.status + thrownError);},
        dataType: "jsonp"
    });  
}
check_progress();


function check_results(){
    $.ajax({
        url: "{% url scanner.views.check_results %}",
        data: "",
        success: function(data) {
            $.each(data, function(key, value) { 
                $("#results").append("<li>desc:" + value.output_desc + "</li>");

            });
            window.setTimeout(check_results,2000);          
        },
        error:function (xhr, ajaxOptions, thrownError){ alert(xhr.status + thrownError);},
        dataType: "jsonp"
    });  
}
check_results();


    
</script>
    
    
    
{% endblock %}
