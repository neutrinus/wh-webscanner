{% extends "base.html" %}
{% load humanize %}

{% block title %}Free scan results{% endblock %}

{% block extrahead %} 
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}style_results.css" />
    <link type="text/css" href="{{ STATIC_URL }}css/ui-lightness/jquery-ui-1.8.16.custom.css" rel="stylesheet" />   
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
    
    <style>
    .ui-progressbar-value { background-image: url({{ STATIC_URL }}css/ui-lightness/images/pbar-ani.gif);  }
    </style>
    
    
    
    <script type="text/javascript">
    testid = {{ test.pk }};
    </script>
{% endblock %}


{% block content %}
<div id="content">
<h1>SCAN Results </h1>

<div id="progressbar"></div>

<div id="results"></div>


<!--<ul>
<li>Screenshots</li>
<li>Basic</li>
<li>SEO</li>
<li>Security</li>
<li>Optimalization</li>
</ul>-->

</div>


<script type="text/javascript">
finished = 0;
$("#progressbar").progressbar({ value: 0 });

function add_result(status, output_desc, output_full) {
    var element = document.createElement('li');
    
    if (status == 0) {
        element.innerHTML += '<img src="{{ STATIC_URL }}status_success.png" /> '
    } else {
        element.innerHTML += '<img src="{{ STATIC_URL }}status_unsuccess.png" /> '
    }
    
    element.innerHTML += output_desc;
    
    $("#results").append(element);   
    $(element).fadeOut(0);
    $(element).fadeIn("slow");
}

function check_progress(){
    $.ajax({
        url: "{% url scanner.views.scan_progress %}",
        data: "",
        success: function(data) {
            $("#progressbar").progressbar({ value: (data.done/data.ordered)*100 });
            if (data.done/data.ordered != 1) {
                window.setTimeout(check_progress,2000);
            } else {
                $("#progressbar").fadeOut();
            }
        },
        error:function (xhr, ajaxOptions, thrownError){ alert(xhr.status + thrownError);},
        dataType: "jsonp"
    });  
}
check_progress();

function check_results(){
    $.ajax({
        url: "{% url scanner.views.check_results %}",
        data: "",
        success: function(data) {
            $.each(data, function(key, value) { 
                add_result(value.status, value.output_desc, value.output_full)
            });
            if (finished == 0) window.setTimeout(check_results,2000);   
            if ($("#progressbar").progressbar("value") == 100) finished = 1;
        },
        error:function (xhr, ajaxOptions, thrownError){ alert(xhr.status + thrownError);},
        dataType: "jsonp"
    });  
}
check_results();   
</script>
    
    
    
{% endblock %}
